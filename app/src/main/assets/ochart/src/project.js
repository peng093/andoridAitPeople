window.__require=function t(e,o,n){function i(a,s){if(!o[a]){if(!e[a]){var r=a.split("/");if(r=r[r.length-1],!e[r]){var d="function"==typeof __require&&__require;if(!s&&d)return d(r,!0);if(c)return c(r,!0);throw new Error("Cannot find module '"+a+"'")}a=r}var h=o[a]={exports:{}};e[a][0].call(h.exports,function(t){return i(e[a][1][t]||t)},h,h.exports,t,e,o,n)}return o[a].exports}for(var c="function"==typeof __require&&__require,a=0;a<n.length;a++)i(n[a]);return i}({Global:[function(t,e,o){"use strict";cc._RF.push(e,"11b2fm1S7hHzo86hefYFvb+","Global");var n=t("axon-tags");e.exports=new function(){this.ochartItem={width:252,height:334},this.mapDotItem={width:10,height:10},this.placeRect={centerX:0,centerY:0,minX:void 0,minY:void 0,maxX:void 0,maxY:void 0},this.$mousePosition=null,this.$mousedown=-1,this.$is_draging=!1,this.$axon_tags=n,this.$baseUrl="",this.$company=null,this.$unChartContacts=null,this.$overContact=null,this.$friends={facebook:[],linkedin:[]},this.$Branchs={},this.theme="night-theme",this.themes={"daytime-theme":{bg:new cc.Color(235,235,235),border:new cc.Color(188,188,188),unaddedBg:new cc.Color(226,224,224),itemDefaultBg:new cc.Color(90,90,90),itemDefaultImg:new cc.Color(240,240,240)},"night-theme":{bg:new cc.Color(61,61,61),border:new cc.Color(41,41,41),unaddedBg:new cc.Color(69,69,69),itemDefaultBg:new cc.Color(65,65,65),itemDefaultImg:new cc.Color(90,90,90)}},Object.defineProperty(this,"ochartPeriphery",{get:function(){return this.getPeriphery(this.ochartItem.width,this.ochartItem.height)}}),Object.defineProperty(this,"mapPeriphery",{get:function(){return this.getPeriphery(this.mapDotItem.width,this.mapDotItem.height)}}),this.getPeriphery=function(t,e){var o={left:0,right:0,top:0,bottom:0,width:0,height:0,centerX:0,centerY:0};return this.placeRect&&"number"==typeof this.placeRect.minX&&(o.left=this.placeRect.minX*t-t/2,o.right=this.placeRect.maxX*t+t/2,o.top=-this.placeRect.minY*e+e/2,o.bottom=-this.placeRect.maxY*e-e/2,o.width=o.right-o.left,o.height=o.top-o.bottom,o.centerX=(o.right+o.left)/2,o.centerY=(o.top+o.bottom)/2),o},this.appToken=""},cc._RF.pop()},{"axon-tags":"axon-tags"}],ajax:[function(t,e,o){"use strict";cc._RF.push(e,"fd5051GoApBtYqqptagYdxQ","ajax");var n=t("request");e.exports.getOchartList=function(t){return n("company/getOchartList",{method:"POST",data:{id:t}})},e.exports.setPlaces=function(t){return n("contacts_grids/multiSet",{method:"POST",data:t})},e.exports.setBranchs=function(t){return n("contacts_company_branch/setRelation",{method:"POST",data:t})},e.exports.setDepts=function(t){return n("contact/setDept",{method:"POST",data:t})},e.exports.createAxon=function(t){return n("axon/create",{method:"POST",data:t})},e.exports.forbidOb=function(t){return n("contact/forbid_ob",{method:"POST",data:t})},cc._RF.pop()},{request:"request"}],"axon-tags":[function(t,e,o){"use strict";cc._RF.push(e,"a130fgeQT9PuZqdZAa1mCcu","axon-tags");e.exports=[{id:37,tag_name:"brochure",project_id:1,path:"https://ici.oss-cn-hongkong.aliyuncs.com/uploads/user/20190507/201905071446367593.png-face.jpg",type_string:["dwdm","gpon_price","ent","isp","gpon_comp"],customize:["debug","logcat"],type:1,type_lable:"#broc_"},{id:41,tag_name:"fbli",project_id:1,path:"https://ici.oss-cn-hongkong.aliyuncs.com/uploads/user/20190507/201905071527071698.png-face.jpg",type_string:["fb_app","li_app","skype_app","sms","line","wehcat"],customize:[],type:1,type_lable:"#filb_"},{id:38,tag_name:"Meet communication",project_id:1,path:"https://ici.oss-cn-hongkong.aliyuncs.com/uploads/user/20190507/201905071446512431.png-face.jpg",type_string:["happy","indifferent","angry","nervous","look good","coffee dinner","ktv"],customize:["emulator"],type:1,type_lable:"#meet_"},{id:39,tag_name:"qtt",project_id:1,path:"https://ici.oss-cn-hongkong.aliyuncs.com/uploads/user/20190507/201905071446317889.png-face.jpg",type_string:["asr 9000","nexus 7000","bras","gpon","switch"],customize:[],type:2,type_lable:"#quote_"},{id:40,tag_name:"tech",project_id:1,path:"https://ici.oss-cn-hongkong.aliyuncs.com/uploads/user/20190507/201905071446395311.png-face.jpg",type_string:["asr 9000","nexus 7000","bras","gpon","switch"],customize:[],type:2,type_lable:"#tech_"}],cc._RF.pop()},{}],"box-to-choose":[function(t,e,o){"use strict";cc._RF.push(e,"06da2Dk4TJIFLkMTlHROGQS","box-to-choose");var n=t("Global"),i=t("ajax"),c=t("post-functions"),a=t("functions"),s={yellow:new cc.Color(146,99,0),green:new cc.Color(29,146,0)};cc.Class({extends:cc.Component,properties:{ochartList:cc.Node,unaddedRoot:cc.Node,dragHandle:cc.Node,unchartedButton:cc.Node},onLoad:function(){var t=this;this.isLeftMouseDown=!1,this.selectList=[],this.lockSelect=!1,this.isClickItem=!1,this.canvas=cc.find("Canvas"),this.unaddedList=cc.find("view/content",this.unaddedRoot),cc.systemEvent.on($OCHART_ITEM_DOWN,function(e,o){var n=window.event;n.altKey||(n.ctrlKey||n.shiftKey||t.init(),t.selecting(o),t.mousedown(e,!0))}),this.mouseOver=0;var e=this.unchartedButton.color;this.unchartedButton.on(cc.Node.EventType.MOUSE_ENTER,function(){t.selectList.length&&n.$is_draging&&(t.mouseOver=1,t.unchartedButton.color=new cc.Color(54,141,74))}),this.unchartedButton.on(cc.Node.EventType.MOUSE_LEAVE,function(o){t.mouseOver=0,t.unchartedButton.color=e}),this.addCartBox=cc.find("add-cart-handle-box",this.dragHandle),this.addCartBox.on(cc.Node.EventType.MOUSE_ENTER,function(e){t.selectList.length&&n.$is_draging&&(t.mouseOver=2,t.addCartBox.color=new cc.Color(49,170,26))}),this.addCartBox.on(cc.Node.EventType.MOUSE_LEAVE,function(e){t.mouseOver=0,t.addCartBox.color=new cc.Color(170,112,26)})},boxShapeSelected:function(){var t={minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0};return this.selectList.forEach(function(e){e.contact.place_x<t.minX&&(t.minX=e.contact.place_x),e.contact.place_x>t.maxX&&(t.maxX=e.contact.place_x),e.contact.place_y<t.minY&&(t.minY=e.contact.place_y),e.contact.place_y>t.maxY&&(t.maxY=e.contact.place_y)}),(t.maxX-t.minX+1)*(t.maxY-t.minY+1)===this.selectList.length},mousedown:function(t,e){var o=this,i=null;if(i="selection"===t.target.name?t.target.parent:t.target,this.isClickItem=e,this.colliderBody=null,this.btn=t.getButton(),c.closePoptip(),!window.event.altKey&&0===this.btn){t.stopPropagation(),this.isLeftMouseDown=!0,n.$is_draging=!0,this.colliderBody=i;var a=this.boxShapeSelected(),r=this.colliderBody.contact.place_x,d=this.colliderBody.contact.place_y;this.selectList.forEach(function(t){t.contact.place_x===r&&a?t.getChildByName("right-collider").active=!0:t.getChildByName("right-collider").active=!1,t.contact.place_y===d&&a?t.getChildByName("bottom-collider").active=!0:t.getChildByName("bottom-collider").active=!1,t.contact.place_y!==d&&t.contact.place_x!==r||!a?t.getChildByName("selection").color=s.yellow:t.getChildByName("selection").color=s.green}),this.node.active=!1,this.canvas.on(cc.Node.EventType.MOUSE_MOVE,this.mouseMove,this),this.canvas.on(cc.Node.EventType.MOUSE_UP,this.mouseUp,this);var h=!1;this.selectList.forEach(function(e){if(!e.active)return h=!0,void o.removeContact(e);e.current=o.getCurrent(e.contact),e.expected={x:null,y:null,place_x:null,place_y:null};var n=t.getLocation();e.mouseToNodePosition=e.convertToNodeSpaceAR(n),e.zIndex=5e3,e.getChildByName("expected-position").active=!0,o.ochartList!==e.parent&&(e.parent=o.ochartList)}),h&&(this.selectList=this.selectList.filter(function(t){return t.active}))}},mouseMove:function(t){var e=this;if(this.isLeftMouseDown){if(1!==window.event.buttons)return this.mouseUp(t);var o=t.getLocation(),n=this.ochartList.convertToNodeSpaceAR(o),i=function(t,o){var i=n.x-t.mouseToNodePosition.x,c=n.y-t.mouseToNodePosition.y;t.setPosition(i,c),t.expected.x=Math.round(i/t.width)*t.width,t.expected.y=Math.round(c/t.height)*t.height;var a=e.ochartList.convertToWorldSpaceAR(cc.v2(t.expected.x,t.expected.y)),s=t.convertToNodeSpaceAR(a),r=t.getChildByName("expected-position");r.setPosition(s),"crash"===o?r.active=!1:r.active||(r.active=!0)};this.mouseOver||this.selectList.some(function(t){return t.collision.body})?this.selectList.forEach(function(t){i(t,"crash")}):this.selectList.forEach(i)}},mouseUp:function(t){var e=this;if(this.canvas.off(cc.Node.EventType.MOUSE_MOVE,this.mouseMove,this),this.canvas.off(cc.Node.EventType.MOUSE_UP,this.mouseUp,this),t.stopPropagation(),this.isLeftMouseDown){this.selectList.forEach(function(t){t.getChildByName("right-collider").active=!1,t.getChildByName("bottom-collider").active=!1}),this.isLeftMouseDown=!1;var o={company_id:n.$company.id,grids:[]};if(2===this.mouseOver){var i=[];this.selectList.forEach(function(t){t.setPosition(t.current.position),t.parent=t.current.parent,t.expected.x=null,t.expected.y=null,t.zIndex=t.current.zIndex;var e=t.getChildByName("expected-position");e.active=!1,e.setPosition(0,0),i.push(t.contact.id)}),i.length&&c.addCart(i)}else if(1===this.mouseOver)this.selectList.forEach(function(t){t.current.parent!==e.unaddedList&&o.grids.push({contact_id:t.contact.id,place_x:null,place_y:null}),t.parent=e.unaddedList;var n=t.getChildByName("expected-position");n.active=!1,n.setPosition(0,0)});else{console.log("this.mouseOver=="+this.mouseOver),this.colliderBody&&this.selectList.some(function(t){return t.collision.body})&&(console.log("\u8fdb\u6765\u4e86"),this.insertOperation());var r=this.ochartList.children.find(function(t){return!(e.selectList.indexOf(t)>-1)&&e.selectList.find(function(e){return t.x===e.expected.x&&t.y===e.expected.y})}),d=!1;this.selectList.forEach(function(t){if(r||null===t.expected.x||void 0===t.expected.y)null===t.contact.place_x?t.parent=e.unaddedList:(cc.tween(t).to(.15,{position:t.current.position}).start(),(window.event.ctrlKey||window.event.shiftKey)&&(d=!0));else{if(t.expected.x!==t.current.position.x||t.expected.y!==t.current.position.y){var n=a.locationToPlace(t.expected.x,t.expected.y);t.expected.place_x=n.place_x,t.expected.place_y=n.place_y,o.grids.push({contact_id:t.contact.id,place_x:n.place_x,place_y:n.place_y})}cc.tween(t).to(.15,{position:cc.v2(t.expected.x,t.expected.y)}).start()}t.zIndex=t.current.zIndex;var i=t.getChildByName("expected-position");i.active=!1,i.setPosition(0,0),1===e.selectList.length&&r&&c.contactMerge(e.selectList[0].contact.id,r.contact.id)}),d&&!this.isClickItem&&(this.removeContact(t.target.parent),this.selectList=this.selectList.filter(function(e){return e!==t.target.parent}))}o.grids.length&&this.execRequest(o,this.selectList)}var h=window.event;h.ctrlKey||h.shiftKey?this.selectList.forEach(function(t){t.getChildByName("selection").color=s.yellow}):this.init(),n.$is_draging=!1,this.btn=-1},start:function(){this.node.active=!1},init:function(){this.selectList&&this.selectList.forEach(this.removeContact.bind(this)),this.selectList=[],this.lockSelect=!1},removeContact:function(t){var e=t.getChildByName("selection");e.color=s.yellow,e.active=!1,e.off(cc.Node.EventType.MOUSE_DOWN,this.mousedown,this)},locking:function(){this.lockSelect=!0},changePlace:function(t){var e={branch_id:t,ids:[]},o=[];this.selectList.forEach(function(n){n.contact.branch_id!==t&&(o.push(n),e.ids.push(n.contact.work_id),n.script.draging())}),o.length&&i.setBranchs(e).then(function(e){o.forEach(function(e){var o=e.script;e.contact.branch_id=t,o.updateAddress()})}).catch(function(t){console.log("\u4fee\u6539\u5931\u8d25",t)}).finally(function(){o.forEach(function(t){t.script.draged()})})},changeDept:function(t){var e={company_id:n.$company.id,dept_id:t,contact_ids:[]},o=[];this.selectList.forEach(function(n){n.contact.dept_id&&n.contact.dept_id===t||(o.push(n),e.contact_ids.push(n.contact.id),n.script.draging())}),o.length&&i.setDepts(e).then(function(e){o.forEach(function(e){var o=e.script;e.contact.dept_id=t,o.updateDept()})}).catch(function(t){console.log("\u4fee\u6539\u5931\u8d25",t)}).finally(function(){o.forEach(function(t){t.script.draged()})})},createAxon:function(t){var e=[];if(this.selectList.forEach(function(t){(!t.contact.tasks||0===t.contact.tasks.length&&0===t.contact.forbid_ob)&&e.push(t.contact.id)}),e.length){var o={contact_ids:e,axon:t};console.log(o),c.createAxons(o)}},selecting:function(t){var e=this;this.selectList.push(t);var o=t.getChildByName("selection");if(o.active=!0,o.on(cc.Node.EventType.MOUSE_DOWN,this.mousedown,this),this.selectList.find(function(t){return t.parent!==e.ochartList})){var n=this.selectList.filter(function(t){return t.parent!==e.ochartList||(e.removeContact(t),!1)});this.selectList=n}this.selectList.sort(function(t,e){return t.y>e.y?-1:t.y<e.y?1:t.x<e.x?-1:t.x>e.x?1:0})},getCurrent:function(t){var e,o;return(e=a.placeTolocation(t.place_x,t.place_y))?o=this.ochartList:(e=cc.v2(0,0),o=this.unaddedList),{position:e,zIndex:t.sort,parent:o}},insertOperation:function(){var t=this,e=this.selectList.length,o=this.selectList[0].contact,i=this.selectList[e-1].contact,c=i.place_y-o.place_y+1,a=i.place_x-o.place_x+1;if(c*a===e){var s,r,d;this.selectList.some(function(t,e){if(t.collision.body)return s=t.collision,r=e,!0});var h={x:0,y:0};if("left"===s.position){d=a;var l=Math.ceil((r+1)/a);h={x:s.body.x,y:s.body.y+(l-1)*n.ochartItem.height}}else{d=c;var p=(r+1)%a;0===p&&(p=a),h={x:s.body.x-(p-1)*n.ochartItem.width,y:s.body.y}}var u={x:0,y:0},f={x:h.x,y:h.y};"left"===s.position?s.forward?u.x=n.ochartItem.width:(f.x-=n.ochartItem.width,u.x=-n.ochartItem.width):"top"===s.position&&(s.forward?u.y=-n.ochartItem.height:(u.y=n.ochartItem.height,f.y+=n.ochartItem.height)),this.selectList.forEach(function(t,e){var o=Math.ceil((e+1)/a);"left"===s.position?(s.forward?t.expected.x=f.x+e%a*u.x:t.expected.x=f.x+(a-1-e%a)*u.x,t.expected.y=f.y-(o-1)*n.ochartItem.height):"top"===s.position&&(s.forward?t.expected.y=f.y+(o-1)*u.y:t.expected.y=f.y+(c-o)*u.y,t.expected.x=f.x+e%a*n.ochartItem.width)});for(var m="left"===s.position?c:a,g=function(e){var o=d,i={x:f.x,y:f.y};for("left"===s.position?i.y=f.y-n.ochartItem.height*e:i.x=f.x+n.ochartItem.width*e;o>0;){var c=t.ochartList.children.some(function(e){if(e.x===i.x&&e.y===i.y)return e.current={position:e.getPosition(),zIndex:e.zIndex,parent:e.parent},e.expected={x:i.x+u.x*o,y:i.y+u.y*o},t.selectList.push(e),!0});i.x+=u.x,i.y+=u.y,c||o--}},v=0;v<m;v++)g(v)}},execRequest:function(t,e){var o=this,n={};t.grids.forEach(function(t){n[t.contact_id]=t}),e.forEach(function(t){t.script.draging()}),i.setPlaces(t).then(function(t){e.forEach(function(t){if(n[t.contact.id]){var e=n[t.contact.id];t.contact.place_x=e.place_x,t.contact.place_y=e.place_y;var i=a.placeTolocation(e.place_x,e.place_y);i?i.x===t.x&&i.y===t.y||t.setPosition(i):t.parent!==o.unaddedList&&(console.log("place \u4e0e loaction \u5bf9\u4e0d\u4e0a2"),t.parent=o.unaddedList,t.setPosition(cc.v2(0,0)))}t.script.draged()}),cc.systemEvent.emit($update_all)}).catch(function(t){e.forEach(function(t){t.script.draged(),o.requestError(t)}),cc.systemEvent.emit($update_all)})},requestError:function(t){var e=this.getCurrent(t.contact);t.parent=e.parent,cc.tween(t).to(.15,{position:e.position}).start()},toggleSelect:function(t){var e=this.selectList.findIndex(function(e){return e===t});e>-1?(this.removeContact(this.selectList[e]),this.selectList.splice(e,1)):this.selecting(t)},onCollisionEnter:function(t,e){this.toggleSelect(t.node)},onCollisionExit:function(t,e){var o=this;setTimeout(function(){if(!o.lockSelect){var e=o.selectList.findIndex(function(e){return e===t.node});e>-1&&(o.removeContact(o.selectList[e]),o.selectList.splice(e,1))}})}}),cc._RF.pop()},{Global:"Global",ajax:"ajax",functions:"functions","post-functions":"post-functions"}],"custom-event":[function(t,e,o){"use strict";cc._RF.push(e,"5ec07T3e1RDXox+xLr6lrdZ","custom-event"),window.$OCHART_CENTER_CHANGE="ochart_center_change",window.$UNADDED_CENTER_CHANGE="unadded_center_change",window.$OCHART_ITEM_DOWN="ochart_item_mousedown",window.$update_all="update_all",window.$update_place="update_place",window.$update_select="update_select",window.$update_contact="update_contact",window.$update_branch="update_branch",window.$PLACE_DOWN="place_down",window.$DEPT_DOWN="dept_down",window.$AXON_DOWN="axon_down",window.$ERROR_HANDLE="error_handle",cc._RF.pop()},{}],"dept.config":[function(t,e,o){"use strict";cc._RF.push(e,"97d4aL88AdG45l3/Al7FHnR","dept.config");var n=[{id:10,name:"bod",description:"bod director (exec & non-exec); share holder; nom-chairman",class:"bod-bg",color:"#004e8b",keyCode:66,code:"b"},{id:9,name:"mgmt",description:"mgmt; president; exec-chairman; ceo; founder; general director",class:"mgmt-bg",color:"#000",keyCode:77,code:"m"},{id:3,name:"fin",description:"finance; controller; accountant; treasurer",class:"fin-bg",color:"#696969",keyCode:70,code:"f"},{id:2,name:"s&m",description:"sales; marketing; business development; channel; distribution; credit ...",class:"sm-bg",color:"#FF83FA",keyCode:83,code:"s"},{id:4,name:"opt",description:"operations; assistant; administration",class:"opt-bg",color:"#A2CD5A",keyCode:67,code:"c"},{id:8,name:"r&d",description:"research and development; software; coding; programming; product manager",class:"rd-bg",color:"#118fed",keyCode:82,code:"r"},{id:6,name:"hr",description:"human resource; organization; human development; training",class:"hr-bg",color:"#A52A2A",keyCode:72,code:"h"},{id:1,name:"ict",description:"it; information technology; networking; system; information security...",class:"tech-bg",color:"#FF8C00",keyCode:84,code:"t"},{id:12,name:"eng",description:"non-ict engineering; construction; electric; automation...",class:"eng-bg",color:"#ffd23e",keyCode:69,code:"e"},{id:13,name:"proc",description:"procurement; logistics; international relationship",class:"proc-bg",color:"#24c4e2",keyCode:81,code:"q"},{id:7,name:"aud",description:"legal; counsel; audit; anti-corruption; interior; internal control; risk control",class:"leg-bg",color:"#ef563b",keyCode:65,code:"a"},{id:0,name:"none",description:"No department",class:"fff-bg",color:"#ffffff",keyCode:78,keyCode2:32,code:"n"},{id:5,name:"svc",description:"customer service; customer support; call center...",class:"svc-bg",color:"#9FB6CD",keyCode:86,code:"v"},{id:11,name:"pur",description:"public relationship; pr; market communication; marcom",class:"pr-bg",color:"#f0b5bf",keyCode:85,code:"u"}],i={};n.forEach(function(t){i[t.id]=t}),e.exports.arr=Object.freeze(n),e.exports.obj=Object.freeze(i),cc._RF.pop()},{}],"dev.contact-sort":[function(t,e,o){"use strict";function n(t){var e=["managing partner","Owner","Chairman","Chair Woman","Chair Person","Managing Director","General Director","Director General","Executive Director","MD","GD","DG","President","SEVP","EVP","SVP","VP","AVP","CEO","Ceo","CFO","Cfo","COO","Coo","CIO","Cio","CTO","Cto","CSO","Cso","Chief","Director","Head","Manager","Control","Procure","Counsel","Lawyer","Legal","Dnsreg","Dnsadm","Dnstech","Asreg","dnsreg","dnsadm","dnstech","asreg"],o=t.positions.split(";"),n=99;["account manager"].some(function(e){return-1===t.positions.toLowerCase().indexOf(e)})&&o.some(function(t){return e.some(function(e,o){if(-1!==t.indexOf(e))return n=o,!0})}),t.sort=n}function i(t){return function(e,o){return e[t]-o[t]}}function c(t,e,o){var n;if(t.contacts_works&&t.contacts_works.length&&(n=t.contacts_works.find(function(t){return t.company_id===o})),e){if(!t.contacts_works.length)return this.$icimsg.error("\u683c\u5f0f\u6709\u8bef\uff0c\u8054\u7cfb\u4eba\uff1a".concat(t.contact_name," \u6ca1\u6709\u5de5\u4f5c\u7ecf\u5386\uff0cid\u4e3a\uff1a").concat(t.id));if(!n)return this.$icimsg.error("\u683c\u5f0f\u6709\u8bef\uff0c\u8054\u7cfb\u4eba\uff1a".concat(t.contact_name," \u6ca1\u6709\u5728\u5f53\u524d\u516c\u53f8\u7684\u5de5\u4f5c\u7ecf\u5386\uff0cid\u4e3a\uff1a").concat(t.id));if(n.is_quit)return this.$icimsg.error("\u683c\u5f0f\u6709\u8bef\uff0c\u8054\u7cfb\u4eba\uff1a".concat(t.contact_name," \u5df2\u5728\u5f53\u524d\u516c\u53f8\u79bb\u804c\uff0cid\u4e3a\uff1a").concat(t.id))}n&&(t.dept_id=n.dept_id,t.company_id=n.company_id,t.company=n.company,t.positions=n.positions,t.is_quit=n.is_quit,t.branch_id=n.branch_id,t.work_id=n.id)}cc._RF.push(e,"3c8d0ym3fxNtbqjDFuPDAJP","dev.contact-sort"),e.exports=function(t,e){return t.forEach(function(t,o){c(t,!1,e),n(t)}),t.sort(i("sort")),t},cc._RF.pop()},{}],"drag-handle":[function(t,e,o){"use strict";cc._RF.push(e,"251e56DstVJw7hW3Gm3kaoA","drag-handle"),cc.Class({extends:cc.Component,properties:{},start:function(){}}),cc._RF.pop()},{}],"error-config":[function(t,e,o){"use strict";cc._RF.push(e,"f0c36NeE1NNPLCVXfRE//I6","error-config"),Object.defineProperty(o,"__esModule",{value:!0}),o.errorConfig=void 0;var n={common_error_code:{code:600,msg:"common error"},linkedin_no_login:{code:101,msg:"linkedin no login"},tianyancha_no_login:{code:104,msg:"tianyancha no login"},twitter_no_login:{code:102,msg:"twitter no login"},facebook_no_login:{code:103,msg:"facebook no login"},no_data_error:{code:130,msg:"no data"},no_access:{code:403,msg:"No access"},timeout_error:{code:411,msg:"abort"},network_error:{code:410,msg:"Network Error"},img_error:{code:412,msg:"Image failed"},not_found:{code:404,msg:"Not found"},parameter_error:{code:1e3,msg:"parameter error"},validate_error:{code:1001,msg:"validate error"},syntax_error:{code:2e3,msg:"Syntax error, Please contact the program manager"},collection_error:{code:2001,msg:""},abort_error:{code:3e3,msg:"\u7528\u6237\u53d6\u6d88\u64cd\u4f5c"}};o.errorConfig=n,e.exports=n,cc._RF.pop()},{}],familys:[function(t,e,o){"use strict";cc._RF.push(e,"7f6cdN0bwVEE60EkfQa9fEP","familys");t("Global");var n=t("functions");cc.Class({extends:cc.Component,properties:{content:cc.Node,family:cc.Prefab,ochartList:cc.Node},onLoad:function(){this.pool=new cc.NodePool("famliy"),this.node.on(cc.Node.EventType.MOUSE_DOWN,function(t){t.stopPropagation()})},init:function(){var t=this;this.content.children.forEach(function(e){t.pool.put(e)}),this.content.removeAllChildren();var e=this.familyGroups();e.length&&e.forEach(function(e){var o=null;(o=t.pool.size()>0?t.pool.get():cc.instantiate(t.family)).getComponent("family").init(e),o.parent=t.content})},isChn:function(t){return/^[\u4E00-\u9FA5]+$/.test(t)},familyGroups:function(){var t=this,e={};this.ochartList.children.forEach(function(o){var i=o.contact,c=n.trim(i.first_name.join(",")).toLowerCase(),a=n.trim(i.last_name.join(",")).toLowerCase();(a.length>=2||1===a.length&&t.isChn(a))&&(e[a]?e[a].push(o):e[a]=[o]),a!==c&&(c.length>=2||1===c.length&&t.isChn(c))&&(e[c]?e[c].push(o):e[c]=[o])});var o=[];for(var i in e)e[i].length>=2&&o.push({family_name:i,nodes:e[i]});return o}}),cc._RF.pop()},{Global:"Global",functions:"functions"}],family:[function(t,e,o){"use strict";cc._RF.push(e,"3fcb0tIXfRPMqWgwEdxDS4p","family"),cc.Class({extends:cc.Component,properties:{num:cc.Label,firstName:cc.Label},onLoad:function(){this.contactIds=[],this.index=0,this.ochartList=cc.find("Canvas/ochart-root/ochart-body/ochart-list"),this.addTo=cc.find("Canvas/handle-btns/a_39")},init:function(t){this.ochartList=cc.find("Canvas/ochart-root/ochart-body/ochart-list"),this.contacts=[],t.nodes.length&&(this.contacts=t.nodes),this.num.string=this.contacts.length,this.firstName.string=t.family_name},blink:function(t){this.scheduleOnce(function(){t.stopAllActions();var e=cc.repeat(cc.sequence(cc.fadeTo(.3,60),cc.fadeTo(.3,255)),5);t.runAction(e)},.33)},onClick:function(t){var e=this;window.event.stopPropagation(),window.event.preventDefault(),void 0===this.contacts[this.index]&&(this.index=0);var o=this.contacts[this.index];o&&o.parent===this.ochartList&&cc.systemEvent.emit($OCHART_CENTER_CHANGE,-o.x,-o.y,!0),this.index++,this.contacts.forEach(function(t){t&&t.parent===e.ochartList?e.blink(t.getChildByName("contact-icon-mask")):e.blink(e.addTo)})},start:function(){}}),cc._RF.pop()},{}],functions:[function(t,e,o){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}cc._RF.push(e,"b51b5RE2clIFoXdvwkioy5a","functions");var i=t("Global");e.exports.timeoutPerform=function(t){var e=0;return function(o){return new Promise(function(n,i){clearTimeout(e),e=setTimeout(function(){if("function"==typeof o){var t=o();if(t instanceof Promise)return void t.then(function(t){n(t)}).catch(i);n()}else n()},t)})}},e.exports.ltrim=function(t,e){if("string"==typeof t){e=e?e.replace(/([\(\)\[\]\*\+\\])/g,"\\$1"):"\\s";var o=new RegExp("^("+e+")*");return t.replace(o,"")}return t},e.exports.rtrim=function(t,e){if("string"==typeof t){e=e?e.replace(/([\(\)\[\]\*\+\\])/g,"\\$1"):"\\s";var o=new RegExp("("+e+")*$");return t.replace(o,"")}return t},e.exports.trim=function(t,o){if("string"==typeof t){var n=e.exports.ltrim(t,o);return e.exports.rtrim(n,o)}return t},e.exports.arrayUnique=function(t){for(var e=[],o={},i=0;i<t.length;i++){var c=t[i];"object"===n(t[i])&&null!=t[i]&&(c=JSON.stringify(t[i])),!o[c]&&t[i]&&(e.push(t[i]),o[c]=1)}return e},e.exports.removeArrayItem=function(t,e){if(t&&t.length){var o=t.indexOf(e);if(o>-1)return t.splice(o,1)}},e.exports.analyzeTextInfo=function(t){var e,o={hasValue:!1,email:[],phone:[],wechat:[],qq:[],skype:[],linkedin:[],facebook:[],twitter:[],crunchbase:[],instagram:[],pinterest:[],asnumber:[],youtube:[],wiki:[],website:[]};if(!t||"string"!=typeof t||t.length<3)return o;var n=/https?:\/\/([^.]*?\.)?facebook\.com\/\S+/i;do{(e=n.exec(t))&&(o.hasValue=!0,o.facebook.push(e[0]),t=t.replace(e[0],""))}while(e);var i=/https?:\/\/([^.]*?\.)?wikipedia\.org\/\S+/i;do{(e=i.exec(t))&&(o.hasValue=!0,o.wiki.push(e[0]),t=t.replace(e[0],""))}while(e);var c=/https?:\/\/([^.]*?\.)?twitter\.com\/\S+/i;do{(e=c.exec(t))&&(o.hasValue=!0,o.twitter.push(e[0]),t=t.replace(e[0],""))}while(e);var a=/https?:\/\/([^.]*?\.)?instagram\.com\/\S+/i;do{(e=a.exec(t))&&(o.hasValue=!0,o.instagram.push(e[0]),t=t.replace(e[0],""))}while(e);var s=/https?:\/\/([^.]*?\.)?crunchbase\.com\/\S+/i;do{(e=s.exec(t))&&(o.hasValue=!0,o.crunchbase.push(e[0]),t=t.replace(e[0],""))}while(e);var r=/https?:\/\/([^.]*?\.)?youtube\.com\/\S+/i;do{(e=r.exec(t))&&(o.hasValue=!0,o.youtube.push(e[0]),t=t.replace(e[0],""))}while(e);var d=/https?:\/\/([^.]*?\.)?pinterest\.com\/\S+/i;do{(e=d.exec(t))&&(o.hasValue=!0,o.pinterest.push(e[0]),t=t.replace(e[0],""))}while(e);var h=/linkedin.com\/(in|company)\/([^\/\?\n]+)\/?/i;do{if(e=h.exec(t)){o.hasValue=!0;var l="https://www.linkedin.com/".concat(e[1],"/").concat(e[2]);o.linkedin.push(l),t=t.replace(e[0],"")}}while(e);if(!["linkedin","facebook","twitter","instagram","pinterest","youtube","wiki"].map(function(t){return o[t].length}).filter(function(t){return t>0}).length){var p=/http(s)?:\/\/\S+/i;do{(e=p.exec(t))&&(o.hasValue=!0,o.website.push(e[0]),t=t.replace(e[0],""))}while(e)}var u=/(as ?\d{1,7})($|\D)/i;do{(e=u.exec(t))&&(o.hasValue=!0,o.asnumber.push(e[1]),t=t.replace(e[0],""))}while(e);var f=/[\w-\.]+?(@|\(at\))[\w-]+?\.[\w-]+(\.[\w-]+)?/gi;do{(e=f.exec(t))&&(o.hasValue=!0,o.email.push(e[0]))}while(e);var m=/(wechat|\u5fae\u4fe1\u53f7?\u662f?)[: \u3000\uff1a.]?[: \u3000\uff1a.]?(\w{4,20})/i;do{(e=m.exec(t))&&(o.hasValue=!0,o.wechat.push(e[2]),t=t.replace(e[2],""))}while(e);var g=/qq[: \u3000\uff1a.]?[: \u3000\uff1a.]??(\d{5,14})($|\D)/i,v=/(\d{6,14})@qq.com/g;do{(e=g.exec(t))&&(o.hasValue=!0,o.qq.push(e[1]),t=t.replace(e[1],""))}while(e);do{(e=v.exec(t))&&(o.hasValue=!0,o.qq.push(e[1]),t=t.replace(e[1],""))}while(e);var y=/skype[: \u3000\uff1a.]?[: \u3000\uff1a.]?(\w{3,20})/i;do{(e=y.exec(t))&&(o.hasValue=!0,o.skype.push(e[1]),t=t.replace(e[1],""))}while(e);var _=/(^|\D)\+?(\d+?[\. -])?[\d\- \.]{6,16}($|\D)/,x=/(1[89]\d\d|2[01]\d\d)[- \._]?(0[1-9]|1[012])[- \._]?(0[1-9]|[12][0-9]|3[01])/;do{(e=_.exec(t))&&!x.test(e[0])&&""!=trim(e[0])&&(o.hasValue=!0,o.phone.push(e[0]),t=t.replace(e[0],""))}while(e);return(o={hasValue:o.hasValue,email:arrayUnique(o.email),phone:arrayUnique(o.phone),wechat:arrayUnique(o.wechat),qq:arrayUnique(o.qq),skype:arrayUnique(o.skype),linkedin:arrayUnique(o.linkedin),facebook:arrayUnique(o.facebook),twitter:arrayUnique(o.twitter),instagram:arrayUnique(o.instagram),pinterest:arrayUnique(o.pinterest),crunchbase:arrayUnique(o.crunchbase),youtube:arrayUnique(o.youtube),wiki:arrayUnique(o.wiki),asnumber:arrayUnique(o.asnumber),website:arrayUnique(o.website)}).phone.forEach(function(t,e){(o.qq.some(function(e){return e==t})||o.skype.some(function(e){return e==t})||o.wechat.some(function(e){return e==t}))&&o.phone.splice(e,1)}),o},e.exports.getUrlParam=function(t,e){var o=e||document.location.search,n=new RegExp("[?&]"+t+"=([^&]+)","g").exec(o),i="";return null!=n&&(i=n[1]),i},e.exports.placeTolocation=function(t,e){if(null===t||void 0===t)return!1;var o=t*i.ochartItem.width,n=-e*i.ochartItem.height;return cc.v2(o,n)},e.exports.locationToPlace=function(t,e){return{place_x:parseInt(t/i.ochartItem.width),place_y:parseInt(-e/i.ochartItem.height)}},cc._RF.pop()},{Global:"Global"}],game:[function(t,e,o){"use strict";cc._RF.push(e,"fcc59ZvDfZBKZR5SizGBwSw","game");var n=t("Global"),i=t("dept.config"),c=t("ajax"),a=t("dev.contact-sort"),s=t("functions"),r=t("post-functions"),d=0;cc.Class({extends:cc.Component,properties:{ochartItem:cc.Prefab,ochartList:cc.Node,unaddedRoot:cc.Node,addToBtn:cc.Node},updateTheme:function(t){var e=cc.find("Canvas/Main Camera").getComponent(cc.Camera),o=cc.find("Canvas/ochart-root/ochart-body/border-bg");if(t&&(n.theme=t),n.themes[n.theme]){var i=n.themes[n.theme];e.backgroundColor=i.bg,o.color=i.border,this.unaddedRoot.color=i.unaddedBg}[this.ochartList.children,this.unaddedList.children].forEach(function(t){t.forEach(function(t){t.script?t.script.updateTheme():t.getComponent("ochart-item").updateTheme()})})},onLoad:function(){var t=this;this.update=this.getComponent("update"),cc.director.getCollisionManager().enabled=!0,cc.view.enableRetina(!0),cc.view.resizeWithBrowserSize(!0),cc.systemEvent.on($UNADDED_CENTER_CHANGE,function(e){t.blink(t.addToBtn)}),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,function(e){var o=e.keyCode,c=window.event;if(!c.ctrlKey&&!c.ctrlKey&&!c.shiftKey)if([cc.macro.KEY.left,cc.macro.KEY.right,cc.macro.KEY.up,cc.macro.KEY.down].includes(o))t.moveOchart(o);else if(cc.macro.KEY.pageup===o)r.flipOver("up");else if(cc.macro.KEY.pagedown===o)r.flipOver("down");else if(n.$overContact)if(cc.macro.KEY.f1===o){if(!n.$overContact.contact.forbid_ob){var a=n.$overContact.script.getRect(n.$overContact.getChildByName("bgs"));r.createAxon(n.$overContact.contact.id,a)}}else if(cc.macro.KEY.f2===o){if(!n.$overContact.contact.forbid_ob){var s=n.$overContact.script.getRect(n.$overContact.getChildByName("bgs"));r.createAp(n.$overContact.contact.id,s)}}else if(cc.macro.KEY.f3===o)t.forbidOb(n.$overContact);else{var d=i.arr.findIndex(function(t){return t.keyCode===o||t.keyCode2===o});if(d>-1){var h=i.arr[d];t.setDept(h)}}}),this.unaddedList=cc.find("view/content",this.unaddedRoot),this.ochartPool=new cc.NodePool("ochart-item");for(var e=0;e<100;++e){var o=cc.instantiate(this.ochartItem);o.active=!1,this.ochartPool.put(o)}},start:function(){var t=this;if(this.updateTheme(),window.parent===window){var e=s.getUrlParam("id");if(!e)return;c.getOchartList(e).then(function(e){e.contacts_list=a(e.contacts_list,e.company.id),t.init(e)})}},moveOchart:function(t){var e=this.ochartList.parent,o=this.node.width,n=this.node.height,i=e.getPosition();switch(t){case cc.macro.KEY.left:i.x+=o;break;case cc.macro.KEY.right:i.x-=o;break;case cc.macro.KEY.up:i.y-=n;break;case cc.macro.KEY.down:i.y+=n}cc.systemEvent.emit($OCHART_CENTER_CHANGE,i.x,i.y,!0)},setDept:function(t){var e=n.$overContact;if(t||e){if(e.isLoading)return;var o=(e.contact.dept_id||"").split(",").map(function(t){return~~t});if(0===t.id)o=[0];else if(o.includes(t.id))o.length>1?s.removeArrayItem(o,t.id):o=[0];else{if(o.length>=4)return;o.includes(0)&&s.removeArrayItem(o,0),o.push(t.id)}var i=o.join(","),a={contact_ids:[e.contact.id],company_id:n.$company.id,dept_id:o.join(",")},r=e.script;r.loading(),c.setDepts(a).then(function(){r.loaded(),e.contact.dept_id=i,r.updateDept()}).catch(function(t){r.loaded(),console.log("\u5feb\u6377\u952e\u4fee\u6539\u90e8\u95e8\u62a5\u9519",t)})}},forbidOb:function(t){if(!t.isLoading){var e={contact_id:t.contact.id,forbid_ob:0===t.contact.forbid_ob?1:0};t.script.loading(),c.forbidOb(e).then(function(){t.contact.forbid_ob=e.forbid_ob,t.script.updateColorCard()}).finally(function(){t.script.loaded()})}},createOchartItem:function(t){var e=null;if((e=this.ochartPool.size()>0?this.ochartPool.get():cc.instantiate(this.ochartItem)).getComponent("ochart-item").init(t,n.$company.id),this.isInOchart(t.place_x,t.place_y)){var o=s.placeTolocation(t.place_x,t.place_y);e.setPosition(o),e.parent=this.ochartList}else e.active=!1,e.zIndex=t.sort,e.parent=this.unaddedList},isInOchart:function(t,e){return null!==t&&null!==e},init:function(t){var e=this;n.$company=t.company,n.$contacts=t.contacts_list,t.baseUrl&&(n.$baseUrl=t.baseUrl),this.ochartList.children.forEach(function(t){e.ochartPool.put(t)}),this.unaddedList.children.forEach(function(t){e.ochartPool.put(t)}),this.ochartList.removeAllChildren(),this.unaddedList.removeAllChildren(),n.$contacts.forEach(function(t){e.createOchartItem(t)}),this.update.all();var o=-n.placeRect.centerX*n.ochartItem.width,i=n.placeRect.centerY*n.ochartItem.height;cc.systemEvent.emit($OCHART_CENTER_CHANGE,o,i)},blink:function(t){this.scheduleOnce(function(){t.stopAllActions();var e=cc.repeat(cc.sequence(cc.fadeTo(.3,60),cc.fadeTo(.3,255)),5);t.runAction(e)},.33)},centerContact:function(t){t.parent===this.ochartList&&cc.systemEvent.emit($OCHART_CENTER_CHANGE,-t.x,-t.y,!0)},clickLinkedinFriend:function(){var t=this;n.$friends.linkedin[d]||(d=0),n.$friends.linkedin[d]&&(this.centerContact(n.$friends.linkedin[d]),d++,n.$friends.linkedin.forEach(function(e){e.parent===t.ochartList?t.blink(e.getChildByName("contact-icon-mask")):t.blink(t.addToBtn)}))},clickFacebookFriend:function(){var t=this;n.$friends.facebook[d]||(d=0),n.$friends.facebook[d]&&(this.centerContact(n.$friends.facebook[d]),d++,n.$friends.facebook.forEach(function(e){e.parent===t.ochartList?t.blink(e.getChildByName("contact-icon-mask")):t.blink(t.addToBtn)}))},clickBranch:function(t){var e=this;if(n.$Branchs[t]){n.$Branchs[t][d]||(d=0);var o=n.$Branchs[t][d];o&&(this.centerContact(o),d++,n.$Branchs[t].forEach(function(t){t.parent===e.ochartList?e.blink(t.getChildByName("contact-icon-mask")):e.blink(e.addToBtn)}))}}}),cc._RF.pop()},{Global:"Global",ajax:"ajax","dept.config":"dept.config","dev.contact-sort":"dev.contact-sort",functions:"functions","post-functions":"post-functions"}],"item-right-bottom-collider":[function(t,e,o){"use strict";cc._RF.push(e,"38c03OL2BRE1YtUqUv20Nxj","item-right-bottom-collider"),cc.Class({extends:cc.Component,properties:{position:"",enterName:{get:function(){return this.position+"-enter"}}},onLoad:function(){},onCollisionEnter:function(t,e){t.node.parent===e.node.parent.parent&&("ochart-item"===t.node.group&&(this.getForward(e.world.aabb,t.world.aabb),this.node.parent.collision.position=this.position,this.node.parent.collision.body=t.node,t.node.getChildByName(this.enterName).active=!0))},onCollisionStay:function(t,e){if(t.node.parent===e.node.parent.parent&&"ochart-item"===t.node.group){this.getForward(e.world.aabb,t.world.aabb);var o=t.node.getChildByName(this.enterName);this.node.parent.collision.forward?o.angle=0:o.angle=180}},getForward:function(t,e){"left"===this.position?t.center.x-e.center.x>0?this.node.parent.collision.forward=!0:this.node.parent.collision.forward=!1:"top"===this.position&&(e.center.y-t.center.y>0?this.node.parent.collision.forward=!0:this.node.parent.collision.forward=!1)},onCollisionExit:function(t,e){var o=this;setTimeout(function(t){"ochart-item"===t.group&&(t.getChildByName(o.position+"-enter").active=!1,o.node.parent.collision={body:null,child:null,forward:!0,position:""})},0,t.node)}}),cc._RF.pop()},{}],loading:[function(t,e,o){"use strict";cc._RF.push(e,"5eaaaaOK6hERJopS51MJn71","loading"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.actions=cc.repeatForever(cc.rotateBy(1,360))},start:function(){this.node.runAction(this.actions)}}),cc._RF.pop()},{}],"map-dot":[function(t,e,o){"use strict";cc._RF.push(e,"87bc8s3+QNHUIlCzwzcG1cU","map-dot"),cc.Class({extends:cc.Component,properties:{blue:cc.SpriteFrame,orangeNode:cc.Node,grey:cc.SpriteFrame,sprite:cc.Sprite},init:function(t){this.node.contact=t,t.tasks&&t.tasks.length?this.orangeNode.active=!0:this.orangeNode.active=!1,t.axon_ap_count?this.sprite.spriteFrame=this.blue:this.sprite.spriteFrame=this.grey},start:function(){}}),cc._RF.pop()},{}],"ochart-item":[function(t,e,o){"use strict";cc._RF.push(e,"2f3a11abeJFz5rYrxlddzpC","ochart-item");var n=t("dept.config"),i=t("Global"),c=t("post-functions"),a=t("ajax"),s={default:new cc.Color(127,127,127),green:new cc.Color(0,197,8),red:new cc.Color(240,93,93)};cc.Class({extends:cc.Component,properties:{contactIcon:{default:null,type:cc.Sprite},defaultSpriteFrame:{default:null,type:cc.SpriteFrame},contactTitle:{default:null,type:cc.Label},bgs:cc.Node,addrCircle:cc.Node,statisticsBg:cc.Node,statistics:cc.Node,medias:[cc.Node],axon:cc.Node},reuse:function(){this.btn=-1},onLoad:function(){this.load()},regain:function(){this.axon.stopAllActions(),this.node.script=this,this.node.isDarg=!1,this.node.isUpload=!1,this.node.isLoading=!1,this.cartTimeout=0,this.btn=-1,this.isClick=!1,this.node.collision={body:null,position:"",forward:!0,child:null},this.node.getChildByName("selection").active=!1,this.node.getChildByName("expected-position").active=!1,this.node.getChildByName("left-enter").active=!1,this.node.getChildByName("top-enter").active=!1,this.node.getChildByName("right-collider").active=!1,this.node.getChildByName("bottom-collider").active=!1,this.updateLoading()},load:function(){var t=this;if(!this.onloaded){this.onloaded=!0,this.axonAction=cc.repeatForever(cc.sequence(cc.scaleTo(.3,.9),cc.scaleTo(.3,1.2))),this.regain(),this.canvas=cc.find("Canvas"),this.expected=this.node.getChildByName("expected-position"),this.ochartList=cc.find("ochart-root/ochart-body/ochart-list",this.canvas),this.dept=cc.find("dept",this.node),this.node.on(cc.Node.EventType.MOUSE_ENTER,function(e){i.$mousedown>-1||(i.$overContact=t.node,t.overCard(e),e.stopPropagation())}),this.node.on(cc.Node.EventType.MOUSE_LEAVE,function(e){t.isClick=!1,clearTimeout(t.cartTimeout)});var e=this.contactIcon.node.parent.getBoundingBox(),o=this.addrCircle.getBoundingBox(),n=this.dept.getBoundingBox(),s=this.contactTitle.node.getBoundingBox();this.axonRect=this.axon.getBoundingBox(),this.node.on(cc.Node.EventType.MOUSE_DOWN,function(i){t.isClick=!0,clearTimeout(t.cartTimeout),c.closePoptip();var a=t.node.convertToNodeSpaceAR(i.getLocation());if(o.contains(a))0===i.getButton()&&(i.stopPropagation(),t.node.contact.branch_id&&cc.systemEvent.emit($PLACE_DOWN,i,t.node.contact.branch_id));else if(t.axonRect.contains(a))0===i.getButton()&&(i.stopPropagation(),t.node.contact.tasks.length&&cc.systemEvent.emit($AXON_DOWN,i,t.node.contact.tasks[0]));else if(e.contains(a)){if(t.node.isDarg)return;0===i.getButton()&&cc.systemEvent.emit($OCHART_ITEM_DOWN,i,t.node)}else n.contains(a)&&0===i.getButton()&&(i.stopPropagation(),t.node.contact.dept_id&&cc.systemEvent.emit($DEPT_DOWN,i,t.node.contact.dept_id))}),this.node.on(cc.Node.EventType.MOUSE_UP,function(e){var r=t.node.convertToNodeSpaceAR(e.getLocation());if(t.isClick&&0===e.getButton())if(n.contains(r)){var d=t.node.contact.dept_id.split(",");if(d.length>1){if(t.node.isLoading)return;var h=d.shift();d.push(h);var l=d.join(","),p={contact_ids:[t.node.contact.id],company_id:i.$company.id,dept_id:l};t.loading(),a.setDepts(p).then(function(){t.node.contact.dept_id=l,t.updateDept(),t.loaded()}).catch(function(e){t.loaded()})}}else if(s.contains(r))c.contactDetail(t.node.contact.id,t.node.contact.company_id);else if(t.axon.active&&t.axonRect.contains(r))t.node.contact.tasks&&t.node.contact.tasks[0]&&c.openAxon(t.node.contact.tasks[0]);else if(o.contains(r)){var u=t.getRect(t.addrCircle);c.openAddress(u,t.node.contact.id)}t.isClick=!1})}},getRect:function(t){var e=t.getBoundingBoxToWorld(),o=cc.game.canvas.height/this.canvas.height,n={left:e.xMin*o,right:e.xMax*o,top:(this.canvas.height-e.yMax)*o,bottom:(this.canvas.height-e.yMin)*o};return{x:n.left,y:n.top,width:n.right-n.left,height:n.bottom-n.top,left:n.left,right:n.right,top:n.top,bottom:n.bottom}},overCard:function(t){var e=this;clearTimeout(this.cartTimeout),this.cartTimeout=setTimeout(function(t){var o=e.getRect(e.bgs);c.openPoptip(o,e.node.contact.id)},300,t)},groupChanged:function(t,e){var o=this;e.group=t,e.children&&e.children.length&&e.children.forEach(function(e){o.groupChanged(t,e)})},init:function(t,e){this.load();var o=this.contactIcon.node.parent;this.width=o.width,this.height=o.height,this.node.contact=t,this.node.companyId=e,this.updateDept(),this.updateIcon(),this.updateAddress(),this.updateMediaFriend(),this.updateStatistics(),this.updateColorCard();var n=99!==t.sort&&t.sort>=0?new cc.Color(255,233,21):new cc.Color(205,205,205);return this.contactTitle.node.color=n,this.contactTitle.string=t.positions+"\n"+t.contact_name,!0},updateTheme:function(){this.updateIcon(),this.updateColorCard()},updateMediaFriend:function(){this.medias.forEach(function(t){t.active=!1,t.color=s.default});var t=!0,e=!1,o=void 0;try{for(var n,i=this.node.contact.contacts_infos[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){var c=n.value;"facebook"==c.type?c.contacts_friends&&c.contacts_friends.length>0&&(this.medias[0].active=!0,this.medias[0].color=s.green):"linkedin"==c.type?c.contacts_friends&&c.contacts_friends.length>0&&(this.medias[1].active=!0,this.medias[1].color=s.green):"email"==c.type&&(this.medias[2].active=!0,1===c.status?this.medias[2].color=s.green:2===c.status&&this.medias[2].color!==s.green&&(this.medias[2].color=s.red))}}catch(t){e=!0,o=t}finally{try{t||null==i.return||i.return()}finally{if(e)throw o}}},updateAddress:function(){var t=this.node.contact.branch_id,e=cc.find("addr-index",this.addrCircle),o=i.$company.company_branchs,n="N",c=new cc.Color(165,165,165,255);if(t){var a=o.findIndex(function(e){return e.id===t});if(a>-1)n=a+1,c=o[a].check_user_id?new cc.Color(45,145,57):new cc.Color(200,56,95)}e.getComponent(cc.Label).string=n,cc.find("address",this.addrCircle).color=c,cc.find("addr-index",this.addrCircle).color=c},updateColorCard:function(){var t=this.node.contact,e=cc.find("ochart-item-inner",this.node),o=new cc.Color(54,141,74);if(this.axon.stopAllActions(),this.axon.active=!1,t.tasks&&t.tasks.length&&(this.axon.active=!0,this.axon.runAction(this.axonAction),this.scheduleOnce(function(){this.axonRect=this.axon.getBoundingBox()},.5)),t.forbid_ob)o=new cc.Color(133,42,8);else if(t.axon_ap_count)o=new cc.Color(0,81,143);else{var n=i.themes[i.theme];n&&(o=n.itemDefaultBg)}e.color=o},updateStatistics:function(){var t=this.node.contact;if(t.all_mezz_count){this.statisticsBg.active=!0,this.statistics.active=!0;var e=t.all_mezz_count>100?"99+":t.all_mezz_count;this.statistics.getComponent(cc.Label).string=e}else this.statisticsBg.active=!1,this.statistics.active=!1},updateDept:function(){var t=this,e=this.node.contact.dept_id;this.bgs.children.forEach(function(t){return t.active=!1});var o=cc.find("dept-label",this.node);if(!e||"0"===e)return this.dept.active=!1,void(o.active=!1);this.dept.active=!0,o.active=!0;var i=e.split(",");i.length>4&&(i.length=4);var c=-1/i.length;i.forEach(function(e,i){var a=n.obj[e];if(!a)return console.log("depts %s \u4e0d\u5b58\u5728",e);var s=t.bgs.children[i];s.active=!0;var r=new cc.Color;r.fromHEX(a.color),s.color=r,0==i&&(t.dept.color=r,o.getComponent(cc.Label).string=a.code);var d=s.getComponent(cc.Sprite);d.fillStart=i*c,d.fillRange=c})},setDefaultIcon:function(){var t=this.contactIcon.node,e=i.themes[i.theme];t.color=e?e.itemDefaultImg:new cc.Color(200,200,200),this.contactIcon.spriteFrame=this.defaultSpriteFrame,t.width=this.width,t.height=this.height},unuse:function(){if(this.regain(),this.node.contact){var t=this.getContactIcon(this.node.contact.contacts_imgs);t&&(this.setDefaultIcon(),cc.loader.release(t))}},updateIcon:function(){var t=this,e=this.contactIcon.node,o=this.getContactIcon(this.node.contact.contacts_imgs);if(!o)return this.setDefaultIcon();this.uploading(),cc.loader.load({url:o,type:"jpg"},function(o,n){if(t.uploaded(),o)return t.setDefaultIcon();var i=t.getContactIcon(t.node.contact.contacts_imgs);if(i&&(n=cc.loader.getRes(i))){var c=t.getImgSize(n.width,n.height);e.opacity=0,e.color=new cc.Color(255,255,255),e.width=c.width,e.height=c.height,e.getComponent(cc.Sprite).spriteFrame=new cc.SpriteFrame(n);var a=cc.fadeIn(.3);e.runAction(a)}})},getContactIcon:function(t){if(t&&t.length){var e=t.find(function(t){return t.is_show});return e?e.thumb_path||e.file_path:t[0].thumb_path||t[0].file_path}return null},getImgSize:function(t,e){var o=0,n=0;return t>e?(o=t/e,n=1):(o=1,n=e/t),{width:parseInt(this.width*o),height:parseInt(this.height*n)}},updateLoading:function(){var t=this.node.getChildByName("loading");if(this.node.isDarg||this.node.isUpload||this.node.isLoading){if(t.active)return;t.active=!0,cc.tween(t).to(.2,{opacity:162}).start()}else{if(!t.active)return;cc.tween(t).to(.2,{opacity:0}).call(function(){t.active=!1}).start()}},draging:function(){this.node.isDarg=!0,this.node.getComponent(cc.BoxCollider).enabled=!1,this.updateLoading()},draged:function(){this.node.isDarg=!1,this.node.getComponent(cc.BoxCollider).enabled=!0,this.updateLoading()},uploading:function(){this.node.isUpload=!0,this.updateLoading()},uploaded:function(){this.node.isUpload=!1,this.updateLoading()},loading:function(){this.node.isLoading=!0,this.updateLoading()},loaded:function(){this.node.isLoading=!1,this.updateLoading()},start:function(){}}),cc._RF.pop()},{Global:"Global",ajax:"ajax","dept.config":"dept.config","post-functions":"post-functions"}],"ochart-root":[function(t,e,o){"use strict";cc._RF.push(e,"9ee1e0JMfdBI7n1j9E2K0Kb","ochart-root");var n=t("Global"),i=t("post-functions"),c=t("functions");cc.Class({extends:cc.Component,properties:{},onLoad:function(){var t=this;cc.sys.dump(),this.canvas=cc.find("Canvas"),this.ochartBody=cc.find("ochart-body",this.node),this.ochartList=cc.find("ochart-list",this.ochartBody),this.boxChoose=cc.find("box-to-choose",this.ochartBody);var e=cc.find("unadded-root",this.canvas);this.chooseScript=this.boxChoose.getComponent("box-to-choose"),this.mapView=cc.find("small-map/map-view",this.canvas),this.btn=-1,this.startX=0,this.startY=0,this.startPosition=null,this.startBodyX=0,this.startBodyY=0,this.type="",this.typeId=0,this.dept_id="",e.on(cc.Node.EventType.MOUSE_DOWN,this.mousedown,this),this.canvas.on(cc.Node.EventType.MOUSE_DOWN,this.mousedown,this),this.canvas.on(cc.Node.EventType.MOUSE_ENTER,function(t){n.$overContact=null,t.stopPropagation()}),cc.systemEvent.on($PLACE_DOWN,function(e,o){var n=window.event;n.ctrlKey||n.shiftKey||n.altKey||(t.type="place",t.typeId=o,t.dept_id=""),t.mousedown(e)}),cc.systemEvent.on($DEPT_DOWN,function(e,o){var n=window.event;n.ctrlKey||n.shiftKey||n.altKey||(t.type="dept",t.typeId=o),t.mousedown(e)}),cc.systemEvent.on($AXON_DOWN,function(e,o){var n=window.event;n.ctrlKey||n.shiftKey||n.altKey||(t.type="axon",t.typeId=o),t.mousedown(e)}),this.canvas.on(cc.Node.EventType.TOUCH_MOVE,function(e){n.$mousePosition=t.ochartList.convertToNodeSpaceAR(e.getLocation()),window.event.buttons?2===n.$mousedown?t.rightDrag(e):0===n.$mousedown&&t.boxToChoose(e):-1!==n.$mousedown&&t.mouseup(e)}),cc.systemEvent.on($update_all,function(){t.scheduleOnce(function(){t.updateVisualContent()},.4)}),window.document.addEventListener("mouseup",this.mouseup.bind(this)),this.canvas.on(cc.Node.EventType.MOUSE_UP,this.mouseup,this),this.canvas.on(cc.Node.EventType.MOUSE_WHEEL,this.mousewheel,this);var o=c.timeoutPerform(200);this.canvas.on(cc.Node.EventType.SIZE_CHANGED,function(){o(function(){t.updateVisualContent()})}),cc.systemEvent.on($OCHART_CENTER_CHANGE,this.setOchartPosition,this)},mousedown:function(t){var e=this;i.closePoptip(),t.stopPropagation(),this.btn=t.getButton(),n.$mousedown=t.getButton(),this.startX=t.getLocationX(),this.startY=t.getLocationY(),this.startPosition=this.ochartList.convertToNodeSpaceAR(t.getLocation()),this.startBodyX=this.ochartBody.x,this.startBodyY=this.ochartBody.y;var o=this.chooseScript.selectList.some(function(t){return t.parent!==e.ochartList});(0===n.$mousedown&&!window.event.shiftKey&&!window.event.ctrlKey||o)&&this.chooseScript.init();var c=this.boxChoose.getChildByName("label").getComponent(cc.Label);switch(this.type){case"place":c.string="Change place";break;case"dept":c.string="Change func";break;case"axon":c.string="Create axon";break;default:c.string=""}},mouseup:function(){if(this.type)switch(this.type){case"place":this.chooseScript.changePlace(this.typeId);break;case"dept":this.chooseScript.changeDept(this.typeId);break;case"axon":this.chooseScript.createAxon(this.typeId)}else 0===n.$mousedown&&this.chooseScript.locking();this.boxChoose.active=!1,this.type="",this.typeId=0,n.$mousedown=-1,this.scheduleOnce(function(){cc.systemEvent.emit($update_select)},.1)},boxToChoose:function(t){var e=this.ochartList.convertToNodeSpaceAR(t.getLocation()),o={};this.startPosition.x>=e.x?(o.left=e.x,o.right=this.startPosition.x):(o.left=this.startPosition.x,o.right=e.x),this.startPosition.y>=e.y?(o.top=this.startPosition.y,o.bottom=e.y):(o.top=e.y,o.bottom=this.startPosition.y),o.width=o.right-o.left,o.height=o.top-o.bottom,o.centerX=(o.right+o.left)/2,o.centerY=(o.top+o.bottom)/2,this.boxChoose.active=!0,this.boxChoose.setPosition(o.centerX,o.centerY),this.boxChoose.width=o.width,this.boxChoose.height=o.height,this.boxChoose.getComponent(cc.BoxCollider).size=new cc.Size(o.width,o.height)},mousewheel:function(t){i.closePoptip();var e=t.getScrollY(),o=this.node.scaleX,n=.5;if(e>0){var c=o+.1;n=c>.7?.7:c}else{var a=o-.1;n=a<.3?.3:a}this.node.setScale(n),this.updateVisualContent()},rightDrag:function(t){var e=t.getLocationX(),o=t.getLocationY(),n=this.node.scaleX,i=this.startBodyX+1*(e-this.startX)/n,c=this.startBodyY+1*(o-this.startY)/n;this.setOchartPosition(i,c)},setOchartPosition:function(t,e,o){var i=this,c=4*n.ochartItem.width,a=4*n.ochartItem.height,s=-n.ochartPeriphery.left+c,r=-n.ochartPeriphery.right-c,d=-n.ochartPeriphery.top-a,h=-n.ochartPeriphery.bottom+a;t<r&&(t=r),t>s&&(t=s),e>h&&(e=h),e<d&&(e=d),o?cc.tween(this.ochartBody).to(.2,{position:cc.v2(t,e)}).call(function(){i.updateVisualContent()}).start():(this.ochartBody.setPosition(t,e),this.updateVisualContent())},updateVisualContent:function(){var t=this.node.scaleX,e=this.canvas.width/t,o=this.canvas.height/t,i=-this.ochartBody.x,c=-this.ochartBody.y,a=i-e/2,s=i+e/2,r=c+o/2,d=c-o/2;this.ochartViewToMapView(r,s,d,a);var h=[],l=n.ochartItem.width/2,p=n.ochartItem.height/2;this.ochartList.children.forEach(function(t){t.getChildByName("selection").active?(t.active||(t.active=!0),h.push(t)):t.x+l>a&&t.x-l<s&&t.y+p>d&&t.y-p<r?(t.active||(t.active=!0),h.push(t)):t.active&&(t.active=!1)})},ochartViewToMapView:function(t,e,o,i){var c=t/n.ochartItem.height*n.mapDotItem.height,a=e/n.ochartItem.width*n.mapDotItem.width,s=o/n.ochartItem.height*n.mapDotItem.height,r=i/n.ochartItem.width*n.mapDotItem.width,d=(a+r)/2,h=(c+s)/2;this.mapView.setPosition(d,h),this.mapView.width=a-r,this.mapView.height=c-s},start:function(){}}),cc._RF.pop()},{Global:"Global",functions:"functions","post-functions":"post-functions"}],"parent-window-message":[function(t,e,o){"use strict";cc._RF.push(e,"fc996JBlEVPx7snVX7Xde3M","parent-window-message");var n=t("Global"),i=t("post-functions");cc.Class({extends:cc.Component,properties:{ochartList:cc.Node,unaddedList:cc.Node,handleBtns:cc.Node},onLoad:function(){this.game=this.getComponent("game"),this.loaded(),window.addEventListener("keydown",function(t){console.log(t.code),["F1","F2","F3","F4"].includes(t.code)&&t.preventDefault()}),document.addEventListener("paste",this.onpaste),cc.game.canvas.addEventListener("dblclick",function(){i.dblclickOchart()}),cc.game.canvas.addEventListener("drop",function(t){t.preventDefault(),t.stopPropagation()}),cc.game.canvas.addEventListener("dragover",function(t){t.preventDefault(),t.stopPropagation()}),cc.systemEvent.on($ERROR_HANDLE,function(t){i.ochartError(t)})},onpaste:function(t){t.preventDefault(),console.log("\u7c98\u8d34\u4e8b\u4ef6");var e,o=t.clipboardData.getData("text/plain");if(n.$overContact)t.clipboardData.files.length?(e=t.clipboardData.files[0],n.$overContact.script.uploading(),i.pasteImg(n.$overContact.contact.id,e)):o&&o.length>3&&i.pasteText(n.$overContact.contact,o);else if(t.clipboardData.files.length&&n.$mousePosition){var c=Math.floor((n.$mousePosition.x+n.ochartItem.width/2)/n.ochartItem.width),a=-Math.floor((n.$mousePosition.y+n.ochartItem.height/2)/n.ochartItem.height);-0==a&&(a=0),i.analysisPicture(t.clipboardData.files[0],c,a)}},loaded:function(){var t=this;window.parent!==window&&i.loaded(),i.initToHtml(),window.addEventListener("message",function(e){var o=e.data;"ochart-iframe"===o.origin&&(console.log("\u5728\u7ec4\u4ef6\u89e6\u53d1\u4e86"+o.method),t[o.method]&&"function"==typeof t[o.method]&&t[o.method](o.data))})},androidMsg:function(t){console.log("\u63a5\u6536\u53c2\u6570"+t),null!=t&&t!={}&&this.ochart_init(t)},theme_change:function(t){this.game.updateTheme(t)},ochart_init:function(t){t.themeName&&this.game.updateTheme(t.themeName),this.game.init(t)},contact_center:function(t){var e=this.ochartList.children.find(function(e){return e.contact.id===t});if(e)return cc.systemEvent.emit($OCHART_CENTER_CHANGE,-e.x,-e.y),void this.game.blink(e);(e=this.unaddedList.children.find(function(e){return e.contact.id===t}))&&(cc.systemEvent.emit($UNADDED_CENTER_CHANGE,e),this.game.blink(e))},branch_center:function(t){this.game.clickBranch(t)},places_change:function(t){var e=this,o=this.ochartList.children.length,i=function(o){if("{}"===JSON.stringify(t))return"break";var i=e.ochartList.children[o],c=t[i.contact.id];if(!c)return"continue";if(c.company_id!==n.$company.id)return"continue";if(i.contact.place_x===c.place_x&&i.contact.place_y===c.place_y)return"continue";if(i.contact.place_x=c.place_x,i.contact.place_y=c.place_y,delete t[i.contact.id],null!==c.place_x){var a=n.ochartItem,s=i.zIndex;i.active=!0,i.zIndex=5e3,cc.tween(i).to(.3,{position:cc.v2(i.contact.place_x*a.width,-i.contact.place_y*a.height)}).call(function(){i.zIndex=s}).start()}else i.active&&cc.tween(i).to(.3,{scale:0}).call(function(){i.parent=e.unaddedList,i.setPosition(cc.v2(0,0)),i.setScale(1)}).start()};t:for(var c=o-1;c>=0;c--){switch(i(c)){case"break":break t;case"continue":continue}}if("{}"!==JSON.stringify(t))for(var a=this.unaddedList.children.length-1;a>=0&&"{}"!==JSON.stringify(t);a--){var s=this.unaddedList.children[a],r=t[s.contact.id];if(r&&r.company_id===n.$company.id&&null!==r.place_x){s.contact.place_x=r.place_x,s.contact.place_y=r.place_y,delete t[s.contact.id];var d=n.ochartItem;s.parent=this.ochartList,s.active=!0,s.scale=0,s.setPosition(cc.v2(s.contact.place_x*d.width,-s.contact.place_y*d.height)),cc.tween(s).to(.3,{scale:1}).start()}}cc.systemEvent.emit($update_place)},contact_change:function(t){null!==t.place_x?this.ochartList.children.some(function(e){if(e.contact.id===t.id)return e.contact=Object.assign(e.contact,t),e.script.init(e.contact,n.$company.id),!0}):this.unaddedList.children.some(function(e){if(e.contact.id===t.id)return e.contact=Object.assign(e.contact,t),e.script.init(e.contact,n.$company.id),!0}),cc.systemEvent.emit($update_contact)},branch_change:function(t){var e=!0,o=!1,n=void 0;try{for(var i,c=this.ochartList.children[Symbol.iterator]();!(e=(i=c.next()).done);e=!0){var a=i.value;if("{}"===JSON.stringify(t))break;t[a.contact.id]&&(a.contact.branch_id=t[a.contact.id],delete t[a.contact.id],a.script.updateAddress())}}catch(t){o=!0,n=t}finally{try{e||null==c.return||c.return()}finally{if(o)throw n}}if("{}"!==JSON.stringify(t)){var s=!0,r=!1,d=void 0;try{for(var h,l=this.unaddedList.children[Symbol.iterator]();!(s=(h=l.next()).done);s=!0){var p=h.value;if("{}"===JSON.stringify(t))break;t[p.contact.id]&&(p.contact.branch_id=t[p.contact.id],delete t[p.contact.id],p.script.updateAddress())}}catch(t){r=!0,d=t}finally{try{s||null==l.return||l.return()}finally{if(r)throw d}}}cc.systemEvent.emit($update_branch)},company_change:function(t){t.company_branchs?(Object.assign(n.$company,t),this.unaddedList.children.forEach(function(t){t.script.updateAddress()}),this.ochartList.children.forEach(function(t){t.script.updateAddress()}),cc.systemEvent.emit($update_all)):Object.assign(n.$company,t)},contact_add:function(t){var e=this;t.forEach(function(t){e.game.createOchartItem(t)}),cc.systemEvent.emit($update_all)},contact_del:function(t){for(var e=this,o=this.ochartList.children,n=function(n){if(!t.length)return"break";var i=o[n],c=t.findIndex(function(t){return i&&i.contact.id==t});c>-1&&(t.splice(c,1),e.game.ochartPool.put(i))},i=o.length-1;i>=0;i--){if("break"===n(i))break}if(t.length)for(var c=this.unaddedList.children,a=function(o){if(!t.length)return"break";var n=c[o],i=t.findIndex(function(t){return n&&n.contact.id==t});i>-1&&(t.splice(i,1),e.game.ochartPool.put(n))},s=c.length-1;s>=0;s--){if("break"===a(s))break}cc.systemEvent.emit($update_all)},img_uploaded:function(t){this.unaddedList.children.some(function(e){if(e.contact.id===t)return e.script.uploaded(),!0})||this.ochartList.children.some(function(e){if(e.contact.id===t)return e.getComponent("ochart-item").uploaded(),!0})},addContact:function(){i.addContact()},gAt:function(){i.gAt()},oGen:function(){i.oGen()},oGenReset:function(){i.oGen(!0)},refreshOchart:function(){i.refreshOchart()}}),cc._RF.pop()},{Global:"Global","post-functions":"post-functions"}],"post-functions":[function(t,e,o){"use strict";function n(t,e){window.parent.postMessage({origin:"ochart-iframe",method:t,data:e},"*")}cc._RF.push(e,"14535nvtelJOKaPQ34kW4H7","post-functions"),e.exports.loaded=function(){n("iframe_loaded",null)},e.exports.contactDetail=function(t,e){n("contact_detail",{id:t,company_id:e})},e.exports.openPoptip=function(t,e){n("open_poptip",{rect:t,id:e})},e.exports.openAddress=function(t,e){n("open_address",{rect:t,id:e})},e.exports.closePoptip=function(){n("close_poptip")},e.exports.addCart=function(t){n("add_cart",t)},e.exports.analysisPicture=function(t,e,o){n("analysis_picture",{file:t,x:e,y:o})},e.exports.dblclickOchart=function(){n("dblclick_ochart")},e.exports.flipOver=function(t){n("flip_over",t)},e.exports.addContact=function(){n("add_contact")},e.exports.gAt=function(){n("g_at")},e.exports.oGen=function(t){n("o_gen",t)},e.exports.refreshOchart=function(){n("refresh_ochart")},e.exports.openAxon=function(t){n("open_axon",t)},e.exports.pasteText=function(t,e){n("paste_text",{contact:t,text:e})},e.exports.pasteImg=function(t,e){n("paste_img",{id:t,file:e})},e.exports.createAxon=function(t,e){n("create_axon",{id:t,rect:e})},e.exports.createAp=function(t,e){n("create_ap",{id:t,rect:e})},e.exports.contactMerge=function(t,e){n("contact_merge",{fromId:t,toId:e})},e.exports.ochartError=function(t){n("ochart_error",t)},e.exports.createAxons=function(t){n("create_axons",t)},e.exports.initToHtml=function(t){n("inited",null)},cc._RF.pop()},{}],request:[function(t,e,o){"use strict";cc._RF.push(e,"ef942PtGGdDWYYWqYStbhoF","request");var n=t("error-config"),i=t("Global");i.$baseUrl="https://test3.hydrophis.cn:5632/v1/api/","fms3.hydrophis.cn"===location.host&&(i.$baseUrl="https://fms3.hydrophis.cn/v1/api/"),e.exports=function(t,e){if(t)return t=i.$baseUrl+t,"[object Object]"===String(e)&&(e=Object.assign({url:"",method:"GET",data:{},responseType:"json"},e)),new Promise(function(o,i){e.method=e.method?e.method.toUpperCase():"GET",e.data=e.data||{};var c=[];for(var a in e.data)c.push("".concat(a,"=",e.data[a]));var s=c.join("&");"GET"===e.method&&c&&(t+=-1===t.indexOf("?")?"".concat("?",s):"".concat("&",s));var r=new XMLHttpRequest;r.responseType=e.responseType||"json",r.onreadystatechange=function(t){var e;if(4===r.readyState)return 200!==r.status?(e=0===r.status?n.network_error:404===r.status?n.not_found:n.common_error_code,cc.systemEvent.emit($ERROR_HANDLE,e),i(e)):r.response&&void 0!==r.response.code?0===r.response.code?o(r.response.data):(cc.systemEvent.emit($ERROR_HANDLE,r.response),i(r.response)):(cc.systemEvent.emit($ERROR_HANDLE,r.response),o(r.response))},r.open(e.method,t,!0),"POST"===e.method&&r.setRequestHeader("Content-Type","application/json"),r.send("POST"===e.method?JSON.stringify(e.data):null)})},cc._RF.pop()},{Global:"Global","error-config":"error-config"}],"small-map":[function(t,e,o){"use strict";cc._RF.push(e,"dcd33kcO7pBLoNrhO5+8H1c","small-map");var n=t("Global"),i=new cc.NodePool;cc.Class({extends:cc.Component,properties:{toggle:cc.Node,ochartList:cc.Node,mapDotList:cc.Node,mapDot:cc.Prefab},init:function(){var t=this;this.mapDotList.children.forEach(function(t){i.put(t)}),this.mapDotList.removeAllChildren(),this.ochartList.children.forEach(function(e){t.creatorMapDot(e.contact)});var e=this.mapDotList.parent,o=e.getComponent(cc.Widget);e.width=n.mapPeriphery.width+50,e.height=n.mapPeriphery.height+50;var c=1;(e.width>400||e.height>400)&&(c=400/e.width>400/e.height?400/e.height:400/e.width),e.setScale(c);var a=!1;0===o.right&&(a=!0);var s=.5-n.mapPeriphery.centerX/e.width,r=.5-n.mapPeriphery.centerY/e.height;e.anchorX=s,e.anchorY=r,a?(o.bottom=0,o.right=0):(o.right=(40-e.width)*c,o.bottom=(40-e.height)*c)},creatorMapDot:function(t){var e=null;(e=i.size()>0?i.get():cc.instantiate(this.mapDot)).getComponent("map-dot").init(t);var o=t.place_x,n=-t.place_y,c=e.width,a=e.height;null!==o&&void 0!==o&&(e.setPosition(o*c,n*a),e.parent=this.mapDotList)},onLoad:function(){var t=this;this.canvas=cc.find("Canvas");for(var e=!1,o=0;o<100;++o)i.put(cc.instantiate(this.mapDot));this.node.on(cc.Node.EventType.MOUSE_DOWN,function(o){if(0===o.getButton()){o.stopPropagation();var i=t.node.convertToNodeSpaceAR(o.getLocation()),c=-i.x/n.mapDotItem.width*n.ochartItem.width,a=-i.y/n.mapDotItem.height*n.ochartItem.height;cc.systemEvent.emit($OCHART_CENTER_CHANGE,c,a),e=!0}}),this.node.on(cc.Node.EventType.MOUSE_MOVE,function(o){if(e){var i=t.node.convertToNodeSpaceAR(o.getLocation()),c=-i.x/n.mapDotItem.width*n.ochartItem.width,a=-i.y/n.mapDotItem.height*n.ochartItem.height;cc.systemEvent.emit($OCHART_CENTER_CHANGE,c,a)}}),this.canvas.on(cc.Node.EventType.MOUSE_UP,function(t){e=!1}),this.toggle.on(cc.Node.EventType.MOUSE_DOWN,function(t){t.stopPropagation()})},setToggle:function(t){var e=this.node.width,o=this.node.height,n=this.getComponent(cc.Widget);0===n.right?(cc.tween(n).to(.3,{right:(40-e)*this.node.scale,bottom:(40-o)*this.node.scale},{easing:"quadIn"}).start(),cc.tween(this.toggle).to(.3,{angle:180},{easing:"quadIn"}).start()):(cc.tween(n).to(.3,{right:0,bottom:0},{easing:"quadOut"}).start(),cc.tween(this.toggle).to(.3,{angle:0},{easing:"quadIn"}).start())}}),cc._RF.pop()},{Global:"Global"}],"unadded-root":[function(t,e,o){"use strict";cc._RF.push(e,"9c11ar0AN9N1ZnLRNLiWBUG","unadded-root");var n=t("Global");cc.Class({extends:cc.Component,properties:{contactList:cc.Node,slider:cc.Slider,sliderLabel:cc.Label,unaddedButton:cc.Node,unaddedButtonLabel:cc.Label},init:function(){this.page_size=Math.floor(this.contactList.width/n.ochartItem.width),this.page=Math.ceil(this.contactList.children.length/this.page_size),this.unaddedButtonLabel.string=this.contactList.children.length,this.current_page>this.page&&(this.current_page=this.page||1),this.progressList=[];for(var t=0;t<this.page;t++){var e=this.page-1;this.progressList.push(parseFloat(((t+.5)/e).toFixed(3)))}0===this.page||1===this.page?this.slider.node.active=!1:this.slider.node.active=!0,this.pageToPosition(this.current_page)},onLoad:function(){var t=this;this.contactList.opacity=0,this.progressList=[],this.current_page=1,this.unaddedButton.on(cc.Node.EventType.MOUSE_DOWN,function(t){t.stopPropagation()}),this.slider.node.on(cc.Node.EventType.MOUSE_DOWN,function(t){t.stopPropagation()}),this.node.on(cc.Node.EventType.SIZE_CHANGED,this.init,this),this.contactList.on(cc.Node.EventType.CHILD_ADDED,this.init,this),this.contactList.on(cc.Node.EventType.CHILD_REMOVED,this.init,this),this.node.on(cc.Node.EventType.MOUSE_WHEEL,function(e){e.stopPropagation(),e.getScrollY()>0?t.current_page>1?(t.current_page--,t.pageToPosition(t.current_page)):t.pageToPosition(1):t.current_page<t.page?(t.current_page++,t.pageToPosition(t.current_page)):t.pageToPosition(t.current_page)}),cc.systemEvent.on($UNADDED_CENTER_CHANGE,function(t){})},changeSlider:function(t){var e=this.progressList.findIndex(function(e){return t.progress<e})+1;this.pageToPosition(e)},pageToPosition:function(t){this.slider.progress=(t-1)/(this.page-1),this.sliderLabel.string=t;var e=(t-1)*this.page_size,o=t*this.page_size;this.contactList.children.forEach(function(t,n){t.active=n>=e&&n<o})},toggleOpen:function(t){t.stopPropagation(),this.isOpen()?this.close():this.open()},isOpen:function(){return 356===this.node.y},open:function(){var t=this;cc.tween(this.node).to(.3,{position:cc.v2(0,356)},{easing:"backOut"}).call(function(){cc.tween(t.contactList).to(.2,{opacity:255}).start()}).start()},close:function(){var t=this;cc.tween(this.node).to(.3,{position:cc.v2(0,550)},{easing:"backIn"}).call(function(){t.contactList.opacity=0}).start()}}),cc._RF.pop()},{Global:"Global"}],update:[function(t,e,o){"use strict";cc._RF.push(e,"40469replBKA5CxcTQ0loG0","update");var n=t("Global");cc.Class({extends:cc.Component,properties:{ochartList:cc.Node,addToBtn:cc.Node,ochartBg:cc.Node,mapRoot:cc.Node,unaddedList:cc.Node,familys:cc.Node},onLoad:function(){var t=this;this.chooseScript=cc.find("ochart-root/ochart-body/box-to-choose",this.node).getComponent("box-to-choose"),cc.systemEvent.on($update_all,function(){t.scheduleOnce(function(){t.all()},.4)}),cc.systemEvent.on($update_place,function(){t.scheduleOnce(function(){t.place()},.4)}),cc.systemEvent.on($update_select,function(){t.updateTotal()}),cc.systemEvent.on($update_contact,function(){t.scheduleOnce(function(){t.contactChange()},.4)}),cc.systemEvent.on($update_branch,function(){t.scheduleOnce(function(){t.updateFriendAndBranch()},.2)})},all:function(){this.initPlaceRect(),this.updateTotal(),this.updateFriendAndBranch(),this.updateBg(),this.familys.getComponent("familys").init(),this.mapRoot.getComponent("small-map").init()},place:function(){this.all()},contactChange:function(){this.updateTotal(),this.updateFriendAndBranch(),this.familys.getComponent("familys").init()},updateBranchGroup:function(){this.ochartList.children.forEach(function(){})},updateBg:function(){this.ochartBg.width=n.ochartPeriphery.width+11*n.ochartItem.width,this.ochartBg.height=n.ochartPeriphery.height+11*n.ochartItem.height,this.ochartBg.setPosition(n.ochartPeriphery.centerX,n.ochartPeriphery.centerY)},initPlaceRect:function(){var t,e,o,i,c=this.ochartList.children;n.placeRect={centerX:0,centerY:0,minX:void 0,minY:void 0,maxX:void 0,maxY:void 0},c.forEach(function(c){if(c.contact){var a=c.contact,s=parseInt(a.place_x),r=parseInt(a.place_y);(void 0===n.placeRect.minX||n.placeRect.minX>s)&&(n.placeRect.minX=s),(void 0===n.placeRect.minY||n.placeRect.minY>r)&&(n.placeRect.minY=r),(void 0===n.placeRect.maxX||n.placeRect.maxX<s)&&(n.placeRect.maxX=s),(void 0===n.placeRect.maxY||n.placeRect.maxY<r)&&(n.placeRect.maxY=r),a.dept_id&&a.dept_id.indexOf("9")>-1&&(i=a),a.tasks&&a.tasks.length&&(!t||t.place_y>r||t.place_y==r&&t.place_x>s)&&(t=a),a.axon_ap_count&&(!e||e.place_y>r||e.place_y==r&&e.place_x>s)&&(e=a),a.all_mezz_count&&(!o||o.place_y>r||o.place_y==r&&o.place_x>s)&&(o=a)}});var a=[i,t,e,o].find(function(t){return!!t});a?(n.placeRect.centerX=a.place_x,n.placeRect.centerY=a.place_y):c[0]&&c[0].contact&&(n.placeRect.centerX=c[0].contact.place_x,n.placeRect.centerY=c[0].contact.place_y)},updateFriendAndBranch:function(){var t=cc.find("left-button",this.node),e=cc.find("linkedin",t),o=cc.find("facebook",t),i=cc.find("linkedin-num",e).getComponent(cc.Label),c=cc.find("facebook-num",o).getComponent(cc.Label),a=this.ochartList.children;n.$friends.facebook=[],n.$friends.linkedin=[],n.$Branchs={},a.forEach(function(t){var e=!1,o=!1,i=t.contact,c=!0,a=!1,s=void 0;try{for(var r,d=i.contacts_infos[Symbol.iterator]();!(c=(r=d.next()).done);c=!0){var h=r.value;if(e&&o)break;h.contacts_friends&&h.contacts_friends.length&&("linkedin"!=h.type||e||(e=!0,n.$friends.linkedin.push(t)),"facebook"!=h.type||o||(o=!0,n.$friends.facebook.push(t)))}}catch(t){a=!0,s=t}finally{try{c||null==d.return||d.return()}finally{if(a)throw s}}i.branch_id&&(n.$Branchs[i.branch_id]?n.$Branchs[i.branch_id].push(t):n.$Branchs[i.branch_id]=[t])}),n.$friends.facebook.length?(o.active=!0,c.enabled=!0,c.string=n.$friends.facebook.length.toString()):(o.active=!1,c.enabled=!1),n.$friends.linkedin.length?(e.active=!0,i.enabled=!0,i.string=n.$friends.linkedin.length.toString()):(e.active=!1,i.enabled=!1)},updateTotal:function(){var t=cc.find("ochart-total",this.node).getComponent(cc.Label),e=cc.find("handle-btns/a_39",this.node),o=cc.find("unchart-num",e).getComponent(cc.Label),n=this.chooseScript.selectList.length,i=this.ochartList.children.length,c=this.unaddedList.children.length;o.string=c,this.addToBtn.getComponent(cc.Button).interactable=!!c,t.string="Total:".concat(i+c," \nOchart:").concat(i," \nChecked:").concat(n)}}),cc._RF.pop()},{Global:"Global"}]},{},["game","Global","ajax","axon-tags","custom-event","dept.config","error-config","functions","post-functions","request","family","loading","map-dot","ochart-item","box-to-choose","dev.contact-sort","drag-handle","familys","item-right-bottom-collider","ochart-root","parent-window-message","small-map","unadded-root","update"]);